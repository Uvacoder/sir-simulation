<!DOCTYPE html><html><head><meta charset="utf-8"><title>SIR Simulation</title><link rel="stylesheet" type="text/css" href="/sir-simulation/style.d1dda12b.css"><script src="https://d3js.org/d3.v3.min.js"></script><script src="https://d3js.org/queue.v1.min.js"></script><script src="https://d3js.org/topojson.v1.min.js"></script><script src="/sir-simulation/simulation.2c95c8d0.js"></script></head><body> <h1>The Spread of Infectious Disease</h1> <div id="vis"> </div> <script>var t=960,e=600,n=d3.select(null),a=d3.select(null),s=d3.geo.albersUsa().scale(1280).translate([t/2,e/2]),o=d3.geo.path().projection(s),i=d3.select("#vis").append("svg").attr("width",t).attr("height",e);i=i.append("g");var d=d3.map(),r=[],l=[];function c(t,e,n,a){if(t)throw t;r=n,i.append("g").attr("class","counties").selectAll("path").data(topojson.feature(e,e.objects.counties).features).enter().append("path").attr("d",o).attr("class","county").attr("id",function(t){return"s"+t.id}).on("mouseover",function(){this.parentNode.appendChild(this),d3.select(this).classed("hovered",!0)}).on("mouseout",function(){d3.select(this).classed("hovered",!1)}).on("click",f),i.append("g").attr("class","states").selectAll("path").data(topojson.feature(e,e.objects.states).features).enter().append("path").attr("d",o).attr("class","state").on("click",u)}function u(s){if(null!=n.node()&&n.node()!=this)return h();n.classed("active",!1),a.classed("active",!1),n=d3.select(this).classed("active",!0);var c=s.id;a=(a=i.select("g.counties").selectAll("path.county").classed("active",function(t){return Math.floor(t.id/1e3)==c&&void 0!==d.get(t.id)})).filter(".active"),l=r.filter(function(t){var e=+t.home_id;return Math.floor(e/1e3)==c&&void 0!==d.get(e)});var u=[];a.each(function(t,e){u.push(new County(e,t.id,d.get(t.id),l.filter(function(e){return+e.home_id==t.id})))});var f=document.getElementById("reproduction").value,m=document.getElementById("duration").value,v=document.getElementById("vacc").value/100;sim.init(u,f*(1/m),1/m,v,p);var g=o.bounds(s),y=g[1][0]-g[0][0],M=g[1][1]-g[0][1],E=(g[0][0]+g[1][0])/2,j=(g[0][1]+g[1][1])/2,B=.9/Math.max(y/t,M/e),I=[t/2-B*E,e/2-B*j];i.transition().duration(750).style("stroke-width",1.5/B+"px").attr("transform","translate("+I+")scale("+B+")")}function f(t){if(!sim.running){var e=Math.floor(document.getElementById("infected").value);sim.start(t.id,e)}}function h(){sim.reset(),n.classed("active",!1),n=d3.select(null),a.classed("active",!1),a=d3.select(null),i.transition().duration(750).style("stroke-width","1.5px").attr("transform","")}function p(t,e,n){document.getElementById("sim_day").innerHTML=Math.floor(n).toLocaleString(),document.getElementById("c_inf").innerHTML=Math.round(t).toLocaleString(),document.getElementById("t_inf").innerHTML=Math.round(e).toLocaleString()}queue().defer(d3.json,"data/us.json").defer(d3.tsv,"data/commuter.tsv").defer(d3.tsv,"data/population.tsv",function(t){d.set(t.id,+t.population)}).await(c),d3.select(self.frameElement).style("height",e+"px");</script> <section> <button class="small" onclick="reset()">Reset</button> <div id="inputs"> <label>Vaccination Rate</label> <input type="number" id="vacc" value="85" min="0"> <br> <label>Initial Number Infected</label> <input type="number" id="infected" value="10" min="0"> <br> <label>Infection Duration (Days)</label> <input type="Number" id="duration" value="3" min="1"> <br> <label>R<sub>0</sub></label> <input type="number" id="reproduction" value="12" min="0"> </div> <aside> <h3>Day: <span id="sim_day">0</span></h3> <h3># Infected: <span id="c_inf">0</span></h3> <h4>(Total Infected: <span id="t_inf">0</span>) </h4></aside> </section> </body></html>